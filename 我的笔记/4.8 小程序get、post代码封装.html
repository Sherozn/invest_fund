<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta name="exporter-version" content="Evernote Mac 7.12 (457935)"/><meta name="author" content="1369822836@qq.com"/><meta name="created" content="2019-08-26 16:16:29 +0000"/><meta name="source" content="desktop.mac"/><meta name="updated" content="2019-09-17 12:26:19 +0000"/><title>4.8 小程序get、post代码封装</title></head><body><div>本节，我们会封装一下get、post请求函数</div><div><br/></div><div>添加基金，需要从基金接口获取信息、将数据插入到数据库中，这些操作都在后端（server文件夹内）进行</div><div>将前端（src文件夹内）的数据传到后端，我们要用到get、post方法。这一节，我们来封装一下这两个方法</div><div>1、打开src/util.js文件，我们先在第一行引入我们在4.1节登录功能中创建的src/config.js文件</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div>import config from './config'</div></div><div><br/></div><div>2、将wx.request请求API包装成一个Promise对象，然后将Promise对象封装在request()函数中</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div>//将Promise对象封装在request()函数中</div><div>function request (url, method, data) {</div><div>  //将wx.request请求API包装成一个Promise对象</div><div>  return new Promise((resolve, reject) =&gt; {</div><div>    //wx.request是微信的API</div><div>    wx.request({</div><div>      url: config.host + url,</div><div>      method,</div><div>      data,</div><div>      success: function (res) {</div><div>        if (res.data.code === 0) {</div><div>          resolve(res.data.data)</div><div>        } else {</div><div>          reject(res.data)</div><div>        }</div><div>      }</div><div>    })</div><div>  })</div><div>}</div></div><div><br/></div><ul><li><div> wx.request是微信一个<span style="font-size: 14px; orphans: 2; widows: 2; color: rgb(34, 34, 34); font-family: -apple-system, system-ui, &quot;SF UI Text&quot;, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; font-variant-ligatures: normal;">发起 HTTPS 网络请求的API</span>，打开小程序文档—API—网络--发起请求可以看到具体应用。</div></li></ul><div><a href="https://developers.weixin.qq.com/miniprogram/dev/api/network/request/wx.request.html">https://developers.weixin.qq.com/miniprogram/dev/api/network/request/wx.request.html</a></div><div><br/></div><ul><li><div>res.data.code === 0</div></li></ul><div>后面我们完善后端代码后，会打印一下调用成功后，返回的res的值，当res.data.code为0时，说明后端返回数据成功，当res.data.code为-1时，说明后端遇到了错误，导致不能成功返回数据，</div><div><br/></div><div>3、get、post工具函数</div><div>在其他文档中引用`import {get,post} from '@/util'`，就可以直接使用get、post请求方法</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">//参考代码，无需粘贴</span></div><div>//function request (url, method, data) {</div><div>   ...</div><div>//}</div><div><br/></div><div>// get工具函数</div><div>export function get (url, data) {</div><div>  //返回的是一个Promise对象</div><div>  return request(url, 'GET', data)</div><div>}</div><div><div><br/></div></div><div>// post工具函数</div><div>export function post (url, data) {</div><div>  //返回的是一个Promise对象</div><div>  return request(url, 'POST', data)</div><div>}</div></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div></body></html>