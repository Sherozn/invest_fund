<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta name="exporter-version" content="Evernote Mac 7.12 (457935)"/><meta name="author" content="1369822836@qq.com"/><meta name="created" content="2019-08-26 16:15:18 +0000"/><meta name="source" content="desktop.mac"/><meta name="source-url" content="https://www.cnblogs.com/SamWeb/p/8417940.html"/><meta name="updated" content="2019-09-05 16:36:19 +0000"/><title>koa入门及Promise、async+await详解</title></head><body><div><br/></div><div>1、安装，生成框架</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div>mkdir koa_demo</div><div><br/></div><div><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">//生成支持npm空的框架</span></div><div>npm init</div><div><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">一直回车</span></div><div><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"><br/></span></div><div><font style="font-family: Monaco;">npm install koa --save</font></div><div><br/></div></div><div><br/></div><div>2、新建文件server.js</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div><font face="Monaco">const koa = require('koa')</font></div><div><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">const app = new Koa()</span></div><div><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"><br/></span></div><div><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">app.use(async(ctx)=&gt;{</span></div><div><font style="font-family: Monaco;">  ctx.body = 'hello koa'</font></div><div><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">})</span></div><div><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;"><br/></span></div><div><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">//监听一个端口</span></div><div><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">app.listen(9090)</span></div></div><div><br/></div><div style="box-sizing: border-box; outline: 0px; padding: 0px; font-size: 16px; overflow-x: auto; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); margin-top: 1em; margin-bottom: 1em;"><span style="box-sizing: border-box; outline: 0px; font-size: 16px; overflow-x: auto; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(77, 77, 77); font-family: &quot;Microsoft YaHei&quot;, &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;-en-paragraph:true;">我们可以看到app.use后面使用了2个参数，</span><span style="box-sizing: border-box; outline: 0px; font-size: 16px; overflow-x: auto; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(77, 77, 77); font-family: &quot;Microsoft YaHei&quot;, &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 26px;-en-paragraph:true;">ctx</span><span style="box-sizing: border-box; outline: 0px; font-size: 16px; overflow-x: auto; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(77, 77, 77); font-family: &quot;Microsoft YaHei&quot;, &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;-en-paragraph:true;">和</span><span style="box-sizing: border-box; outline: 0px; font-size: 16px; overflow-x: auto; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(77, 77, 77); font-family: &quot;Microsoft YaHei&quot;, &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 26px;-en-paragraph:true;">next</span><span style="box-sizing: border-box; outline: 0px; font-size: 16px; overflow-x: auto; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(77, 77, 77); font-family: &quot;Microsoft YaHei&quot;, &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;-en-paragraph:true;">，下面我们介绍一个这哥俩到底干嘛的</span></div><div style="box-sizing: border-box; outline: 0px; padding: 0px; font-size: 16px; overflow-x: auto; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); margin-top: 1em; margin-bottom: 1em;"><span style="box-sizing: border-box; outline: 0px; font-size: 16px; overflow-x: auto; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(77, 77, 77); font-family: &quot;Microsoft YaHei&quot;, &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;-en-paragraph:true;">ctx</span></div><div style="box-sizing: border-box; outline: 0px; padding: 0px; font-size: 16px; overflow-x: auto; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); margin-top: 1em; margin-bottom: 1em;"><span style="box-sizing: border-box; outline: 0px; font-size: 16px; overflow-x: auto; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(77, 77, 77); font-family: &quot;Microsoft YaHei&quot;, &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;-en-paragraph:true;">ctx是Koa将 node 的 </span><span style="box-sizing: border-box; outline: 0px; font-size: 16px; overflow-x: auto; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(77, 77, 77); font-family: &quot;Microsoft YaHei&quot;, &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 26px;-en-paragraph:true;">request</span><span style="box-sizing: border-box; outline: 0px; font-size: 16px; overflow-x: auto; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(77, 77, 77); font-family: &quot;Microsoft YaHei&quot;, &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;-en-paragraph:true;">, </span><span style="box-sizing: border-box; outline: 0px; font-size: 16px; overflow-x: auto; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(77, 77, 77); font-family: &quot;Microsoft YaHei&quot;, &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 26px;-en-paragraph:true;">response</span><span style="box-sizing: border-box; outline: 0px; font-size: 16px; overflow-x: auto; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(77, 77, 77); font-family: &quot;Microsoft YaHei&quot;, &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;-en-paragraph:true;"> 对象封装进一个单独对象。可以通过ctx访问</span><span style="box-sizing: border-box; outline: 0px; font-size: 16px; overflow-x: auto; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(77, 77, 77); font-family: &quot;Microsoft YaHei&quot;, &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 26px;-en-paragraph:true;">request和</span><span style="box-sizing: border-box; outline: 0px; font-size: 16px; overflow-x: auto; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(77, 77, 77); font-family: &quot;Microsoft YaHei&quot;, &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 26px;-en-paragraph:true;">response</span><span style="box-sizing: border-box; outline: 0px; font-size: 16px; overflow-x: auto; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(77, 77, 77); font-family: &quot;Microsoft YaHei&quot;, &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;-en-paragraph:true;">即</span><span style="box-sizing: border-box; outline: 0px; font-size: 16px; overflow-x: auto; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(77, 77, 77); font-family: &quot;Microsoft YaHei&quot;, &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 26px;-en-paragraph:true;">ctx.request</span><span style="box-sizing: border-box; outline: 0px; font-size: 16px; overflow-x: auto; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(77, 77, 77); font-family: &quot;Microsoft YaHei&quot;, &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;-en-paragraph:true;"> 、 </span><span style="box-sizing: border-box; outline: 0px; font-size: 16px; overflow-x: auto; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(77, 77, 77); font-family: &quot;Microsoft YaHei&quot;, &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 26px;-en-paragraph:true;">ctx.response</span><span style="box-sizing: border-box; outline: 0px; font-size: 16px; overflow-x: auto; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(77, 77, 77); font-family: &quot;Microsoft YaHei&quot;, &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;-en-paragraph:true;">。</span></div><div style="box-sizing: border-box; outline: 0px; padding: 0px; font-size: 16px; overflow-x: auto; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); margin-top: 1em; margin-bottom: 1em;"><span style="box-sizing: border-box; outline: 0px; font-size: 16px; overflow-x: auto; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(77, 77, 77); font-family: &quot;Microsoft YaHei&quot;, &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;-en-paragraph:true;">next</span></div><div style="box-sizing: border-box; outline: 0px; padding: 0px; font-size: 16px; overflow-x: auto; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); margin-top: 1em; margin-bottom: 1em;"><span style="box-sizing: border-box; outline: 0px; font-size: 16px; overflow-x: auto; overflow-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(77, 77, 77); font-family: &quot;Microsoft YaHei&quot;, &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;-en-paragraph:true;">next 是指的下一个中间件</span></div><div><br/></div><div>3、执行命令,启动项目</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div>node server.js</div></div><div>访问<a href="http://localhost:3000/">http://localhost:9090/</a></div><div>会打印出<span style="font-family: Monaco;">hello koa</span></div><div><br/></div><div><span style="font-family: Monaco;">4、洋葱圈</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div>const Koa = require('koa');</div><div>const app = new Koa();</div><div><br/></div><div>// 第一个中间件</div><div>app.use(async (ctx, next) =&gt; {</div><div>    ctx.body = "1";</div><div>    await next(); </div><div>    ctx.body += " 2";</div><div>});</div><div><br/></div><div>app.use(async (ctx, next) =&gt; {</div><div>    ctx.body += " 3";</div><div>    await next();</div><div>    ctx.body += " 4";</div><div>});</div><div><br/></div><div>app.use(async (ctx, next) =&gt; {</div><div>    ctx.body += " 5";</div><div>    await next();</div><div>    ctx.body += " 6";</div><div>});</div><div><br/></div><div>app.listen(9090);</div></div><div><br/></div><div><span style="font-family: Monaco;"><img src="koa%E5%85%A5%E9%97%A8%E5%8F%8APromise%E3%80%81async+await%E8%AF%A6%E8%A7%A3.html.resources/23BAE3A6-0076-45BA-994A-38007A83A7B0.png" height="105" width="256"/><br/></span></div><div><br/></div><div><span style="font-family: Monaco;">5、回调地狱</span></div><div>在异步请求中，第二个请求中的一个参数，需要从第<span style="-en-paragraph:true;">一个请求中获取。那么就需要将第二个请求嵌套在第一个请求中，如果还有第三个第四个请求需要在上一个请求执行完才能执行，就都需要嵌套在上一个请求中，这就是回调地狱。我们用setTimeout延时器来给大家演示一下，这样看着比较简单，但是如果每层都有大量的代码，就会变成一团乱码~这就要用到Promise来拯救我们的代码</span></div><div><img src="koa%E5%85%A5%E9%97%A8%E5%8F%8APromise%E3%80%81async+await%E8%AF%A6%E8%A7%A3.html.resources/F9A21EDD-AAA8-48A4-BB2B-0D5260606892.jpg" height="400" width="440"/><br/></div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div>setTimeout(function(){</div><div>  console.log("第1个延时器");</div><div><br/></div><div>  setTimeout(function(){</div><div>    console.log("第2个延时器");</div><div><br/></div><div>    setTimeout(function(){</div><div>      console.log("第3个延时器");</div><div><br/></div><div>      setTimeout(function(){</div><div>        console.log("第4个延时器");</div><div><br/></div><div>      },2000)</div><div><br/></div><div>    },2000)</div><div><br/></div><div>  },2000)</div><div><br/></div><div>},2000)</div></div><div><br/></div><div><span style="font-family: Monaco;">6、Promise基础知识</span></div><div><span style="font-family: Monaco;">我们先来new一个Promise对象,P</span><span style="font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(51, 51, 51); font-family: Verdana, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">romise的构造函数接收一个参数，是函数，并且给这个函数传入两个参数：resolve，reject。</span><span style="font-size: 14px; orphans: 2; widows: 2; color: rgb(51, 51, 51); font-family: Verdana, Arial, Helvetica, sans-serif; font-variant-ligatures: normal;">如果得到我们想要的结果，就调用</span><span style="color: rgb(51, 51, 51); font-family: Verdana;">resolved，</span><span style="color: rgb(51, 51, 51); font-family: Verdana;">可以继续往下执行，如果</span>得到<span style="font-size: 16px; color: rgb(47, 47, 47);">了我们不想要的结果</span>，就调用reject拒绝执行。</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div>var p = new Promise(function(resolve, reject) {</div><div>        if (typeof num == 'number') {</div><div>            resolve();</div><div>        } else {</div><div>            reject();</div><div>        }</div><div>    })</div></div><div><br/></div><div><span style="font-family: Monaco;">我们通常会把</span><span style="font-family: Monaco;">Promise对象对象放在一个函数中，然后调用这个函数会return一个</span><span style="font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(51, 51, 51); font-family: Verdana, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">Promise对象，后面直接跟then方法。像下面这样</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div>//把Promise对象放在一个函数中</div><div>function fn(num) {</div><div>    return new Promise(function(resolve, reject) {</div><div>        if (typeof num == 'number') {</div><div>            resolve();</div><div>        } else {</div><div>            reject();</div><div>        }</div><div>    })</div><div>}</div><div><br/></div><div><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">//调用函数</span>fn(1234)，返回一个Promise对象，Promise.then方法有两个参数，第一个参数是接收resolved状态的执行（也就是typeof num == 'number'时执行resolve()），第二个参数是接收reject状态的执行（（也就是typeof num != 'number'时执行reject()））。</div><div>fn(1234).then(function() {</div><div>    console.log('参数是一个number值');</div><div>  })</div><div>.then(null, function() {</div><div>    console.log('参数不是一个number值');</div><div>  })</div></div><div><br/></div><div><span style="font-family: Monaco;">还可以这样写，大家可以对比上面，体会一下里面的参数传递</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div>function fn(num) {</div><div>    return new Promise(function(resolve, reject) {</div><div>        if (typeof num == 'number') {</div><div>            resolve('参数是一个number值');</div><div>        } else {</div><div>            reject('参数不是一个number值');</div><div>        }</div><div>    })</div><div>}</div><div><br/></div><div>//调用函数fn(1234)，返回一个Promise对象</div><div>//.then方法有两个参数，第一个参数function(y)执行的是resolve('参数是一个number值');</div><div>//第二个参数function(n)执行的是reject('参数不是一个number值');</div><div>fn(1234).then(function(y) {</div><div>    console.log(y);</div><div>  })</div><div>.then(null, function(n) {</div><div>    console.log(n);</div><div>  })</div></div><div><br/></div><div><br/></div><div><span style="font-family: Monaco;">7、</span><span style="font-family: Monaco;">我们将上面的回调地狱用Promise改进一下</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div>function setTime(num) {</div><div>  return new Promise(function(resolve, reject) {</div><div>    setTimeout(function(){</div><div>      resolve("第" + num + "个延时器");</div><div>    },2000)</div><div>  })</div><div>}</div><div><br/></div><div>setTime(1).then((num)=&gt;{</div><div>    console.log(num);</div><div>    //给setTime方法重新传参，并返回Promise对象</div><div>    return setTime(2)</div><div>})</div><div>.then((num)=&gt;{</div><div>    console.log(num);</div><div>    return setTime(3)</div><div>})</div><div>.then((num)=&gt;{</div><div>    console.log(num);</div><div>    return setTime(4)</div><div>})</div><div>.then((num)=&gt;{</div><div>    console.log(num);</div><div>})</div></div><div><span style="font-family: Monaco;">打印的结果如下：</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div>xuzhaoning@xuchaoningdeair:~/WeChatProjects/woa$ node server.js</div><div>第1个延时器</div><div>第2个延时器</div><div>第3个延时器</div><div>第4个延时器</div></div><div><br/></div><div>8、<span style="font-family: Monaco;">async和await基础知识</span></div><div><span style="font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(68, 68, 68); font-family: Tahoma, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">async</span><span style="font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(68, 68, 68); font-family: Tahoma, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">就是异步的意思，</span><span style="font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(68, 68, 68); font-family: Tahoma, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">会作为一个关键字放到函数前面，用来表示函数是一个异步函数。</span></div><div><span style="font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(68, 68, 68); font-family: Tahoma, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">await是等待的意思，后面常放一个promise对象。await关键字只能放到async函数里面。</span></div><div><span style="font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><br/></span></div><div><span style="font-size: 11pt;"><a href="https://www.cnblogs.com/SamWeb/p/8417940.html" style="font-size: 11pt; font-family: Tahoma;">https://www.cnblogs.com/SamWeb/p/8417940.html</a></span></div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div>function setTime(num) {</div><div>  return new Promise(function(resolve, reject) {</div><div>    setTimeout(function(){</div><div>      resolve("第" + num + "个延时器");</div><div>    },2000)</div><div>  })</div><div>}</div><div><br/></div><div>async function testResult() {</div><div>    //执行到await暂停，执行完setTime(1)将返回值赋值给result后，暂停结束，继续向下执行</div><div>    let result = await setTime(1);</div><div>    //await暂停结束，继续向下执行console.log</div><div>    console.log(result);</div><div>}</div><div><br/></div><div><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;">//最后调用</span>testResult()函数</div><div>testResult()</div></div><div><br/></div><div style="margin: 10px auto; padding: 0px; list-style-type: none; list-style-image: none; text-indent: 0px; font-size: 14px; letter-spacing: normal; orphans: 2; text-align: start; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="text-indent: 0px; font-size: 14px; letter-spacing: normal; orphans: 2; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(68, 68, 68); font-family: Tahoma, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">打开控制台，2s 之后，输出结果如下：</span></div><div style="margin: 10px auto; padding: 0px; list-style-type: none; list-style-image: none; text-indent: 0px; font-size: 14px; letter-spacing: normal; orphans: 2; text-align: start; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div>xuzhaoning@xuchaoningdeair:~/WeChatProjects/woa$ node server.js</div><div>第1个延时器</div></div></div><div style="margin: 10px auto; padding: 0px; list-style-type: none; list-style-image: none; text-indent: 0px; font-size: 14px; letter-spacing: normal; orphans: 2; text-align: start; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="text-indent: 0px; font-size: 14px; letter-spacing: normal; orphans: 2; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(68, 68, 68); font-family: Tahoma, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">我们看看代码的执行过程，执行testResult函数，遇到了await, await 表示等一下，要</span><span style="text-indent: 0px; font-size: 14px; letter-spacing: normal; orphans: 2; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(68, 68, 68); font-family: Tahoma, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">等后面的promise对象</span><span style="font-size: 11pt; color: rgb(68, 68, 68); font-family: Tahoma; font-variant-caps: normal; font-variant-ligatures: normal;">setTime(1)</span><span style="text-indent: 0px; font-size: 14px; letter-spacing: normal; orphans: 2; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(68, 68, 68); font-family: Tahoma, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">执行完，现在代码暂停在await这里，开始执行</span><span style="font-size: 11pt; color: rgb(68, 68, 68); font-family: Tahoma; font-variant-caps: normal; font-variant-ligatures: normal;">setTime(1)，</span><span style="text-indent: 0px; font-size: 14px; letter-spacing: normal; orphans: 2; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(68, 68, 68); font-family: Tahoma, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">执行到</span><span style="font-size: 14px; color: rgb(68, 68, 68); font-family: Tahoma;">setTime(1)方法中的</span><span style="text-indent: 0px; font-size: 14px; letter-spacing: normal; orphans: 2; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(68, 68, 68); font-family: Tahoma, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">resolve拿到了返回值----「</span><span style="font-size: 14px; color: rgb(68, 68, 68); font-family: Tahoma;">第1个延时器</span><span style="text-indent: 0px; font-size: 14px; letter-spacing: normal; orphans: 2; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(68, 68, 68); font-family: Tahoma, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">」，将这个</span><span style="font-size: 11pt; color: rgb(68, 68, 68); font-family: Tahoma; font-variant-caps: normal; font-variant-ligatures: normal;">返回值</span><span style="text-indent: 0px; font-size: 14px; letter-spacing: normal; orphans: 2; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(68, 68, 68); font-family: Tahoma, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">赋值给result，</span><span style="text-indent: 0px; font-size: 14px; letter-spacing: normal; orphans: 2; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(68, 68, 68); font-family: Tahoma, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">await这里的</span><span style="text-indent: 0px; font-size: 14px; letter-spacing: normal; orphans: 2; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(68, 68, 68); font-family: Tahoma, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">暂停结束，代码继续向下执行console.log语句。</span></div><div><br/></div><div><span style="font-family: Monaco;">9、我们用async和await再优化一下代码</span></div><div><span style="font-family: Monaco;">原代码</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div>function setTime(num) {</div><div>  return new Promise(function(resolve, reject) {</div><div>    setTimeout(function(){</div><div>      resolve("第" + num + "个延时器");</div><div>    },2000)</div><div>  })</div><div>}</div><div><br/></div><div><br/></div><div>setTime(1).then((num)=&gt;{</div><div>    console.log(num);</div><div>    //给setTime方法重新传参，并返回Promise对象</div><div>    return setTime(2)</div><div>})</div><div>.then((num)=&gt;{</div><div>    console.log(num);</div><div>    return setTime(3)</div><div>})</div><div>.then((num)=&gt;{</div><div>    console.log(num);</div><div>    return setTime(4)</div><div>})</div><div>.then((num)=&gt;{</div><div>    console.log(num);</div><div>})</div></div><div><br/></div><div><span style="font-family: Monaco;">优化后</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div>//setTime方法没有变化</div><div>function setTime(num) {</div><div>  return new Promise(function(resolve, reject) {</div><div>    setTimeout(function(){</div><div>      resolve("第" + num + "个延时器");</div><div>    },2000)</div><div>  })</div><div>}</div><div><br/></div><div>async function better(){</div><div>  const num1 = await setTime(1);</div><div>  console.log(num1)</div><div>  const num2 = await setTime(2);</div><div>  console.log(num2)</div><div>  const num3 = await setTime(3);</div><div>  console.log(num3)</div><div>  const num4 = await setTime(4);</div><div>  console.log(num4)</div><div>}</div><div><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco;">//最后调用一下better方法</span></div><div>better()</div></div><div><span style="font-family: Monaco;">打印的结果如下：</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div>xuzhaoning@xuchaoningdeair:~/WeChatProjects/woa$ node server.js</div><div>第1个延时器</div><div>第2个延时器</div><div>第3个延时器</div><div>第4个延时器</div></div><div><br/></div></body></html>